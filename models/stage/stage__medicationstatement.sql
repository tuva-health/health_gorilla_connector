
-- SELECT statement for MedicationStatement
SELECT 
    resourcetype,
    id,
    meta_versionid,
    meta_lastupdated,
    extension_0_url,
    extension_0_valuereference_reference,
    extension_1_url,
    extension_1_valuestring,
    extension_2_url,
    extension_2_valuestring,
    extension_3_url,
    extension_3_valuereference_reference,
    extension_4_url,
    extension_4_valuereference_reference,
    extension_5_url,
    extension_5_valuereference_reference,
    partof_0_reference,
    status,
    medicationcodeableconcept_text,
    subject_reference,
    subject_display,
    effectiveperiod_start,
    effectiveperiod_end,
    informationsource_reference,
    note_0_text,
    dosage_0_route_coding_0_system,
    dosage_0_route_coding_0_code,
    dosage_0_route_coding_0_display,
    dosage_0_doseandrate_0_dosequantity_value,
    dosage_0_doseandrate_0_dosequantity_unit,
    effectivedatetime,
    dosage_0_additionalinstruction_0_coding_0_system,
    dosage_0_additionalinstruction_0_coding_0_code,
    dosage_0_additionalinstruction_0_text,
    dosage_0_additionalinstruction_1_coding_0_system,
    dosage_0_additionalinstruction_1_coding_0_code,
    dosage_0_additionalinstruction_1_coding_0_display,
    dosage_0_additionalinstruction_1_text,
    reasoncode_0_coding_0_system,
    reasoncode_0_coding_0_code,
    reasoncode_0_text,
    dosage_0_timing_repeat_period,
    dosage_0_timing_repeat_periodunit,
    reasoncode_1_coding_0_system,
    reasoncode_1_coding_0_code,
    reasoncode_1_text,
    reasoncode_2_coding_0_system,
    reasoncode_2_coding_0_code,
    reasoncode_2_text,
    filename,
    processed_date 
FROM {{source('raw', 'medicationstatement') }} x
QUALIFY rank() over(partition by filename order by processed_date desc) = 1
