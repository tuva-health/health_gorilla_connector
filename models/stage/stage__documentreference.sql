
-- SELECT statement for DocumentReference
SELECT 
    resourcetype,
    id,
    meta_versionid,
    meta_lastupdated,
    text_status,
    text_div,
    contained_0_resourcetype,
    contained_0_id,
    contained_0_name_0_text,
    extension_0_url,
    extension_0_valuedatetime,
    identifier_0_system,
    identifier_0_value,
    status,
    type_coding_0_system,
    type_coding_0_code,
    type_coding_0_display,
    type_coding_1_system,
    type_coding_1_code,
    type_coding_1_display,
    type_text,
    subject_reference,
    subject_display,
    date,
    author_0_display,
    authenticator_reference,
    authenticator_display,
    description,
    securitylabel_0_coding_0_system,
    securitylabel_0_coding_0_code,
    securitylabel_0_coding_0_display,
    securitylabel_0_text,
    content_0_attachment_contenttype,
    content_0_attachment_url,
    content_0_attachment_size,
    content_0_attachment_hash,
    content_0_attachment_title,
    content_0_attachment_creation,
    content_0_format_system,
    content_0_format_code,
    content_0_format_display,
    content,
    category_0_coding_0_system,
    category_0_coding_0_code,
    category_0_coding_0_display,
    filename,
    processed_date 
FROM {{source('raw', 'documentreference') }} x
QUALIFY rank() over(partition by filename order by processed_date desc) = 1
